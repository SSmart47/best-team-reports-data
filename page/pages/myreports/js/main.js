const firebaseConfig={apiKey:"AIzaSyAqCTjwhTzgLUV_HrGLhdxjxx5nFR4g0Sg",authDomain:"betsteamreportsdata.firebaseapp.com",databaseURL:"https://betsteamreportsdata-default-rtdb.firebaseio.com",projectId:"betsteamreportsdata",storageBucket:"betsteamreportsdata.appspot.com",messagingSenderId:"507208715373",appId:"1:507208715373:web:2f6188e8252c868f8a0364"};firebase.initializeApp(firebaseConfig);var username=localStorage.getItem("ss47_bestteamreportsdata_user_i"),_u_n_=localStorage.getItem("ss47_bestteamreportsdata_user_n");function JsonToList(e){var t,r=e,a=[];for(t in r)a.push([t,r[t]]);return a}async function ObjectList(){var t=[];return await firebase.database().ref().child("objects").get().then(e=>{e.exists()?(e=e.val(),t=JsonToList(e)):console.log("Error in Server!")}).catch(e=>{alert("No connection to server!"),console.error(e)}),t}async function UserObjectList(e){var t=[];return await firebase.database().ref().child("users").child(username).child("reports").child(e).get().then(e=>{e.exists()?(e=e.val(),t=JsonToList(e)):console.log("Error in Server!")}).catch(e=>{alert("No connection to server!"),console.error(e)}),t}function SubStr(e,t,r){var a="";t<0&&(t=0),r>e.length&&(r=e.length);for(var o=t;o<r;o++)a+=e[o];return a}function UpdateList(){firebase.database().ref().child("users").child(username).child("reports").get().then(e=>{if(e.exists()){for(var t=document.getElementById("id_list_1"),r=JsonToList(e.val()),a="",o=0;o<r.length;o++){var s=r[o][0];a+='<tr><th scope="row">'+(o+1)+"</th>",a+="<td>"+s+"</td>",a+="<td>",a+='<div class="btn-group" role="group" aria-label="Basic example">',a+='<button class="btn btn-success" onclick="SendReport(\''+s+"')\">Отправить в группу</button>",a+='<button class="btn btn-secondary" onclick="EditReport(\''+s+"')\">Изменить</button>",a+='<button class="btn btn-danger" onclick="RemoveReport(\''+s+"')\">Удалить</button>",a+="</div>",a+="</td>",a+="</tr>"}t.innerHTML=a}else console.log("No Reports!"),document.getElementById("id_list_1").innerHTML=""}).catch(e=>{alert("No Connection!"),console.error(e)})}function DMY(e){var t="",r="",a="",o=0;e+="-";for(var s=0;s<e.length;s++)"-"==e[s]?o++:0==o?a+=e[s]:1==o?r+=e[s]:t+=e[s];return[t,r,a]}function RemoveReport(e){firebase.database().ref("users/"+username+"/reports/"+e).remove(),console.log("Removed: "+e),UpdateList()}function Part(e,t){for(var r="",a="",o=0,s=0;s<e.length;s++)"-"==e[s]?o++:0==o?r+=e[s]:a+=e[s];return 1==t?r:a}function ToHour(e){var t=parseInt(e),r=parseInt(t/60),a="",e="";return e+=t%=60,(a+=r).length<2&&(a="0"+a),e.length<2&&(e="0"+e),a+":"+e}function Fixed(e){return e.length%2==1&&(e="0"+e),e}function ConvertedURL(e){for(var t="",r=0;r<e.length;r++)"а"<=e[r]&&e[r]<="я"||"А"<=e[r]&&e[r]<="Я"||"a"<=e[r]&&e[r]<="z"||"A"<=e[r]&&e[r]<="Z"||"ё"==e[r]||"Ё"==e[r]?t+=e[r]:t+="%"+Fixed(e.charCodeAt(r).toString(16));return t}UpdateList(),document.getElementById("id_btn_back").onclick=function(){localStorage.setItem("ss47_bestteamreportsdata_user_i",username),localStorage.setItem("ss47_bestteamreportsdata_user_n",_u_n_),window.location="../../main.html"},document.getElementById("id_btn_add_report").onclick=async function(){var o,s,e=document.getElementById("id_report_date").value;""!=e?(o="",o+=e,s=await ObjectList(),firebase.database().ref().child("users").child(username).child("reports").child(o).get().then(e=>{if(e.exists())console.log("You already had report in this date!"),alert("You already had report in this date!");else{for(var t=0;t<s.length;t++){var r=s[t][1].type,a="";"num"==r||"time"==r?a="0":"speed"==r&&(a="0-0"),firebase.database().ref("users/"+username+"/reports/"+o+"/"+s[t][0]).set({value:a,type:r})}UpdateList(),console.log("Add!")}}).catch(e=>{alert("No Connection!"),console.error(e)})):alert("Wrong Date!")};async function SendReport(e){var t=await UserObjectList(e);if(!(t.length<1)){var r="",e=DMY(e);r+=e[0]+"."+e[1]+"."+e[2];var a="";a+=_u_n_+"\n",a+="  "+r+"\n";for(var o=0;o<t.length;o++){var s=t[o][1].type,n=t[o][0],i=t[o][1].value;a+=n+": ","num"==s?a+=i:"time"==s?a+=ToHour(i):"speed"==s&&(a+=Part(i,1)+" / "+ToHour(Part(i,2))),a+="\n"}console.log(a),a=ConvertedURL(a),console.log(a);try{let e=await fetch("https://api.telegram.org/bot1901121050:AAFdyRKsvA66C63GgP9wZkqd6_W5aLoFiyc/sendMessage?chat_id=-433552411&text="+a);await e.json()}catch{alert("You are offline!"),console.log("Error")}}}function EditReport(e){localStorage.setItem("ss47_bestteamreportsdata_user_i",username),localStorage.setItem("ss47_bestteamreportsdata_user_n",_u_n_),localStorage.setItem("ss47_bestteamreportsdata_user_d",e),window.location="reporteditor/reporteditor.html"}
